@model WebMVC.Models.BattleMapTransViewModel
@using BackgroundLogic.InputOutput

@{
    ViewBag.Title = "Battle Mapa";
    int w = Model.StateData.Width;
    int h = Model.StateData.Height;
    int r_size = 50;
}

<div style="margin: 10px">
    <a class="btn btn-primary"  href="../BattleMap/Clear">Wyczyść</a>
</div>

<div id="battle-map-board" style="position:relative; width:@(w*r_size)px; height:@(h*r_size)px; border-bottom: 1px solid black; border-left: 1px solid black;">


    @for (int x = 0; x < w; x++)
    {
        for (int y = 0; y < h; y++)
        {
            <a @(Model.StateData.MovingId != 0 ? $"href=../BattleMap/Move/{y * w + x}" : "")>
                <div style="
                        position: absolute;
                        left:   @(x*r_size)px;
                        bottom: @(y*r_size)px;
                        width:  @(r_size)px;
                        height: @(r_size)px;
                        border-top: 1px solid black;
                        border-right: 1px solid black;
                        "
                     class="board-cell"
                     pos_x="@x"
                     pos_y="@y">
                </div>
            </a>
        }
    }
    @for (int id = 0; id < Model.FullInitiative.Count(); id++)
    {
        <a @(Model.StateData.MovingId != 0 ? $"" : $"href=../BattleMap/SetToMove/{Model.FullInitiative[id].Id}")>
            <div style="
                                                position: absolute;
                                                left:   @((Model.FullInitiative[id].PositionX)*(r_size))px;
                                                bottom: @((Model.FullInitiative[id].PositionY)*(r_size))px;
                                                width:  @(r_size)px;
                                                height: @(r_size)px;
                                                "                 
                 class="board-cell"
                 pos_x="@Model.FullInitiative[id].PositionX"
                 pos_y="@Model.FullInitiative[id].PositionY">

                <img src="@Url.Action("GetImg", new { path = (FileIO.GetProgDataPath(Model.FullInitiative[id].ImagePath)), type = (Model.FullInitiative[id].CreatureType) })" style="width:100%; height:100%" 
                 data-toggle="tooltip" 
                 data-placement="top" 
                 title = @(Model.FullInitiative[id].Name)>

            </div>
        </a>
    }




</div>

<style>
    .body-content{
        padding:0px;
    }
</style>

<script>
   // window.onload = load;

    function load() {

        var w = window.innerWidth*0.988;
        var scale = w / 1000;
        var cell_size = 30 * scale;

        document.getElementById("battle-map-board").style.width = w + "px";
        document.getElementById("battle-map-board").style.height = ((w)/2) + "px";

        var cells = document.getElementsByClassName("board-cell");
        for (let i = 0; i < cells.length; i++) {
            var x = cells[i].getAttribute("pos_x"); 
            var y = cells[i].getAttribute("pos_y");

            
            cells[i].style.left = (x * cell_size) + "px";
            cells[i].style.bottom = (y * cell_size) + "px";
            cells[i].style.width = cell_size + "px";
            cells[i].style.height = cell_size + "px";

        }
    }
</script>